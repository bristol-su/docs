<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Testing :: Bristol SU Portal Project</title>
    <link rel="canonical" href="https://bristol-su.github.io/docs/support/v4.x/sdk-api/testing.html">
    <meta name="description" content="Testing a module">
    <meta name="docsearch:description" content="Testing a module">
    <meta name="keywords" content="testing,module testing,phpunit">
    <meta name="docsearch:keywords" content="testing,module testing,phpunit">
    <meta name="generator" content="Antora 2.3.4">
    <meta name="docsearch:language" content="en" />
      <meta name="docsearch:version" content="master">
      <meta name="docsearch:component" content="SDK (Support)">
      <meta name="docsearch:module" content="sdk-api">
  <link rel="stylesheet" href="../../_/css/site.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162373885-2"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-162373885-2')</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://bristol-su.github.io/docs">Bristol SU Portal Project</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
          <div class="navbar-item hide-for-print">
            <input id="search-input" type="text" placeholder="Search docs (/)">
          </div>
        <a class="navbar-item" href="https://bristol-su.github.io/docs">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../api-client-php/1.0.0/index.html">API Client</a>
                <a class="navbar-item" href="../../control-frontend/develop/developers/index.html">Control</a>
                <a class="navbar-item" href="../../playground/develop/index.html">Playground</a>
                <a class="navbar-item" href="../../portal/develop/index.html">Portal</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Modules</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../module-assign-roles/1.0.0/index.html">Assign Roles</a>
                <a class="navbar-item" href="../../module-data-entry/1.0.0/index.html">Data Entry</a>
                <a class="navbar-item" href="../../module-flyerless-club-management/1.0.0/index.html">Flyerless Club Management</a>
                <a class="navbar-item" href="../../module-static-page/1.0.0/index.html">Static Page</a>
                <a class="navbar-item" href="../../module-template/1.0.0/index.html">Template</a>
                <a class="navbar-item" href="../../module-typeform/1.0.0/index.html">Typeform</a>
                <a class="navbar-item" href="../../module-upload-file/1.0.0/index.html">Upload File</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Developers</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../api-client-php-toolkit/1.0.0/index.html">API Client Toolkit</a>
                <a class="navbar-item" href="../../control-api/develop/developers/index.html">Control (API)</a>
                <a class="navbar-item" href="../v4.x/creating-module/index.html">SDK (Support)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Integrations</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../integration-airtable/develop/index.html">AirTable</a>
                <a class="navbar-item" href="../../integration-unioncloud-control/develop/developers/index.html">UnionCloud</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://tobytwigger.myjetbrains.com/youtrack/newIssue">Open an Issue</a>
            <a class="button is-primary" href="https://github.com/bristol-su/portal">Get Started</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="support" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../creating-module/index.html">SDK (Support)</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Creating a Module</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/setup.html">Setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/module-layout.html">Module Layout</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/service-provider.html">Service Provider</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/developing.html">Developing a Module</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/releasing.html">Releasing a Module</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Frontend</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../frontend/index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../frontend/pages.html">Setting up Pages</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../frontend/api.html">Creatng an API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../frontend/using-js-vue.html">Using JS and Vue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDK API</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Basics</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authentication-authorization.html">Authentication &amp; Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="database.html">Database</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="control.html">Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="storage.html">Storage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extra Features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Helping your module</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="settings.html">Settings</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="testing.html">Testing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="events.html">Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="connections.html">Connections</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="stand-alone.html">Stand-alone features</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="filters.html">Filters</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="commands.html">Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="actions.html">Actions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="completion-conditions.html">Completion Conditions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SDK (Support)</span>
    <span class="version">master prerelease</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">AirTable</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../integration-airtable/develop/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">API Client</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-client-php/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">API Client Toolkit</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-client-php-toolkit/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Assign Roles</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-assign-roles/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Control</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../control-frontend/develop/developers/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Control (API)</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../control-api/develop/developers/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Control API Client</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-client-php-module-control/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Data Entry</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-data-entry/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Flyerless Club Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-flyerless-club-management/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../home/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Playground</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../playground/develop/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Portal</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../portal/develop/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">SDK (Support)</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../creating-module/index.html">master prerelease</a>
        </li>
        <li class="version is-latest">
          <a href="../v4.x/creating-module/index.html">v4.x</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Static Page</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-static-page/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Template</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-template/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Typeform</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-typeform/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Typeform Service</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../service-typeform/develop/users/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">UnionCloud</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../integration-unioncloud-control/develop/developers/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Upload File</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-upload-file/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../home/1.0.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../creating-module/index.html">SDK (Support)</a></li>
    <li>SDK API</li>
    <li>Extra Features</li>
    <li>Helping your module</li>
    <li><a href="testing.html">Testing</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">master prerelease</button>
  <div class="version-menu">
    <a class="version is-current" href="testing.html">master prerelease</a>
    <a class="version" href="../v4.x/sdk-api/testing.html">v4.x</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/bristol-su/support/edit/master/antora-docs/modules/sdk-api/pages/testing.adoc">Edit this Page</a></div>
  
    <div class="view-on-github"><a href="https://github.com/bristol-su/support">View on GitHub</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Testing</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>To make sure your module works as expected, we highly recommend testing your module fully. You should use PHPUnit, and write tests for all features in your module.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_set_up_the_environment"><a class="anchor" href="#_set_up_the_environment"></a>Set up the environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve set you up with a TestCase through the template module. This extends the SDK TestCase from <code>\BristolSU\Support\Testing\TestCase</code>, which in turn extends Orchestra TestBench. This means you can use PHPUnit with all the testing tools Laravel provides, and benefit from the SDK Testing Tools.</p>
</div>
<div class="paragraph">
<p>The SDK TestCase loads the SDK, sets up a testing database and an app key, and sets up necessary authentication configuration. In your TestCase (this is done for you in the template module), you should load your service provider by copying the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">protected function getPackageProviders($app)
{
  return array_merge(parent::getPackageProviders($app), [
    \My\Alias\ModuleServiceProvider::class
  ]);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use a number of useful traits to make testing even easier.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handlesauthentication"><a class="anchor" href="#_handlesauthentication"></a>HandlesAuthentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is included with the <code>CreatesModuleEnvironment</code> trait. You can
create new users, groups and roles by using <code>$this-&gt;newUser()</code>,
<code>$this-&gt;newGroup()</code> and <code>$this-&gt;newRole()</code>. You can pass an array
like <code>['data_provider_id' =&gt; 1]</code> to this function.</p>
</div>
<div class="paragraph">
<p>You can also set the current user/group/role with
<code>$this-&gt;beUser($user)</code>, <code>$this-&gt;beGroup($group)</code>,
<code>$this-&gt;beRole($role)</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handlesauthorization"><a class="anchor" href="#_handlesauthorization"></a>HandlesAuthorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is included with the <code>CreatesModuleEnvironment</code> trait. It
provides a set of helper methods to make testing with authorization much
easier.</p>
</div>
<div class="paragraph">
<p><code>$this-&gt;bypassAuthorization();</code> - Any permission tests will always
return true</p>
</div>
<div class="paragraph">
<p><code>$this-&gt;givePermissionTo('ability');</code> - The current user will be given
the ability</p>
</div>
<div class="paragraph">
<p><code>$this-&gt;revokePermissionTo('ability');</code> - The current user will not be
given the ability</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fakeslogictesters"><a class="anchor" href="#_fakeslogictesters"></a>FakesLogicTesters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This allows you to create a logic tester. A logic tester accepts a logic
group and a user/group/role and checks if the models are in the logic
group. You may use a logic tester in your module - if you were letting
users be assigned to groups and wanted a logic group to get users from,
you&#8217;d use the logic tester.</p>
</div>
<div class="paragraph">
<p>To mock this behaviour, so you don&#8217;t have to set up the logic group
accurately, you can use the 'FakesLogicTesters' trait.</p>
</div>
<div class="paragraph">
<p>The following example shows the setup of a logic tester. This logic
tester will return true if <code>$logic</code> is tested against
<code>$user, $group, $role</code> , false if the logic is tested against
<code>$user1, $group1, $role1</code>, and false otherwise.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$this-&gt;logicTester()
    -&gt;forLogic($logic) // Let the logic tester know what logic the following applies to
    -&gt;pass($user, $group, $role) // If the given user/group/role (any can be null) match those being evaluated, will return true
    -&gt;fail($user2, $group2, $role2) // If the given user/group/role (any can be null) match those being evaluated, will return false
    -&gt;otherwise(false) // Default to return if no match found. Defaults to false.</pre>
</div>
</div>
<div class="paragraph">
<p>To then use the logic tester, or determine results for other logics, you
can repeat the same process. Just calling <code>$this-&gt;logicTester()</code> will
return the logic tester ready to use.</p>
</div>
<div class="paragraph">
<p>Of course, often the logic tester should be bound to the container to be
used throughout the sdk, module or portal. Instead of doing this
manually, you can call <code>$this-&gt;logicTester()-&gt;bind()</code> to instantly
bind the logic tester into the container.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_assertseloquentmodels"><a class="anchor" href="#_assertseloquentmodels"></a>AssertsEloquentModels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This contains a helper method for asserting eloquent models are equal:</p>
</div>
<div class="paragraph">
<p><code>$this-&gt;assertModelEquals($expectedModel, $actualModel, $message)</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_createsmoduleenvironment"><a class="anchor" href="#_createsmoduleenvironment"></a>CreatesModuleEnvironment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This trait sets up the environment for testing a module whilst framed as
a module. For example, it will create a module instance, an activity,
and logs into authentication credentials.</p>
</div>
<div class="paragraph">
<p>It also provides helper functions to get urls from this information, for
making requests to your module during testing.</p>
</div>
<div class="paragraph">
<p>To initialise the trait, call <code>createModuleEnvironment($alias)</code> in
your setUp method. You must pass in your module alias for the setup to
work. Before calling this method, you can customise the module
environment</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setModuleIsFor($for)</code>: Specifies who the module is for (a 'user', a
'group' or a 'role'). Defaults to 'user'</p>
</li>
<li>
<p><code>setActivity($activity)</code>: Specify the activity to use</p>
</li>
<li>
<p><code>setModuleInstance($moduleInstance)</code>: Specify the module instance to
use</p>
</li>
<li>
<p><code>setActivityInstance($activityInstance)</code>: Specify the activity to
use</p>
</li>
<li>
<p><code>setControlUser($user)</code>: Sets the control user to use for testing.</p>
</li>
<li>
<p><code>setControlGroup($group)</code>: Sets the control group to use for
testing.</p>
</li>
<li>
<p><code>setControlRole($role)</code>: Sets the control role to use for testing.</p>
</li>
<li>
<p><code>setDatabaseUser($user)</code>: Sets the database user to use</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With all these customisations, get functions are also defined to
retrieve the value. If previously set before calling
createModuleEnvironment, they will return the values that were set.
Otherwise, it will return newly created values.</p>
</div>
<div class="sect2">
<h3 id="_urls"><a class="anchor" href="#_urls"></a>Urls</h3>
<div class="paragraph">
<p>Finally, the following functions manipulate data about the activity to
provide helpful shortcuts. For example, creating a URL for the module to
send requests to.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>adminUrl($path = '')</code>: Returns the url to the admin side of a
module. Give a path to navigate to this page instead (e.g. '/files').</p>
</li>
<li>
<p><code>userUrl($path = '')</code>: Return the url to the user side.</p>
</li>
<li>
<p><code>adminApiUrl($path = '')</code>: Return the url to the admin API</p>
</li>
<li>
<p><code>userApiUrl($path = '')</code>: Return the url to the participant API</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_settings"><a class="anchor" href="#_settings"></a>Settings</h3>
<div class="paragraph">
<p>You can change the value of the settings by using the following snippet</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">\BristolSU\Support\ModuleInstance\Settings\ModuleInstanceSetting::create([
  'module_instance_id' =&gt; $this-&gt;getModuleInstance-&gt;id(),
  'key' =&gt; 'setting_key',
  'value' =&gt; false
]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Value accepts any variable type, and will handle casting to a format for
the database automatically.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using Antora.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
var search = docsearch({
  appId: 'X72DC2WY93',
  apiKey: '5a0df2d12ae0305890f5ff4ab7621747',
  indexName: 'portal-docs',
  inputSelector: '#search-input',
  autocompleteOptions: { autoselect: true, hint: false, keyboardShortcuts: ['/'] },
  algoliaOptions: { hitsPerPage: 10 }
}).autocomplete
search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
function focusSearchInput () { document.querySelector('#search-input').focus() }
if (document.querySelector('.home-link.is-current')) window.addEventListener('load', focusSearchInput)
</script>

<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
