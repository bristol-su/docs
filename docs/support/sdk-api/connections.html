<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Connections :: Bristol SU Portal Project</title>
    <link rel="canonical" href="https://bristol-su.github.io/docs/support/v4.x/sdk-api/connections.html">
    <meta name="description" content="Using third party connections">
    <meta name="docsearch:description" content="Using third party connections">
    <meta name="keywords" content="api,third party,client,external data,external client,connector,connection,request">
    <meta name="docsearch:keywords" content="api,third party,client,external data,external client,connector,connection,request">
    <meta name="generator" content="Antora 2.3.4">
    <meta name="docsearch:language" content="en" />
      <meta name="docsearch:version" content="master">
      <meta name="docsearch:component" content="SDK (Support)">
      <meta name="docsearch:module" content="sdk-api">
  <link rel="stylesheet" href="../../_/css/site.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162373885-2"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-162373885-2')</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://bristol-su.github.io/docs">Bristol SU Portal Project</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
          <div class="navbar-item hide-for-print">
            <input id="search-input" type="text" placeholder="Search docs (/)">
          </div>
        <a class="navbar-item" href="https://bristol-su.github.io/docs">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../api-client-php/1.0.0/index.html">API Client</a>
                <a class="navbar-item" href="../../control-frontend/develop/developers/index.html">Control</a>
                <a class="navbar-item" href="../../playground/develop/index.html">Playground</a>
                <a class="navbar-item" href="../../portal/develop/index.html">Portal</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Modules</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../module-assign-roles/1.0.0/index.html">Assign Roles</a>
                <a class="navbar-item" href="../../module-data-entry/1.0.0/index.html">Data Entry</a>
                <a class="navbar-item" href="../../module-flyerless-club-management/1.0.0/index.html">Flyerless Club Management</a>
                <a class="navbar-item" href="../../module-static-page/1.0.0/index.html">Static Page</a>
                <a class="navbar-item" href="../../module-template/1.0.0/index.html">Template</a>
                <a class="navbar-item" href="../../module-typeform/1.0.0/index.html">Typeform</a>
                <a class="navbar-item" href="../../module-upload-file/1.0.0/index.html">Upload File</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Developers</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../api-client-php-toolkit/1.0.0/index.html">API Client Toolkit</a>
                <a class="navbar-item" href="../../control-api/develop/developers/index.html">Control (API)</a>
                <a class="navbar-item" href="../v4.x/creating-module/index.html">SDK (Support)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Integrations</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../integration-airtable/develop/index.html">AirTable</a>
                <a class="navbar-item" href="../../integration-unioncloud-control/develop/developers/index.html">UnionCloud</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://tobytwigger.myjetbrains.com/youtrack/newIssue">Open an Issue</a>
            <a class="button is-primary" href="https://github.com/bristol-su/portal">Get Started</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="support" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../creating-module/index.html">SDK (Support)</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Creating a Module</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/setup.html">Setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/module-layout.html">Module Layout</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/service-provider.html">Service Provider</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/developing.html">Developing a Module</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../creating-module/releasing.html">Releasing a Module</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Frontend</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../frontend/index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../frontend/pages.html">Setting up Pages</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../frontend/api.html">Creatng an API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../frontend/using-js-vue.html">Using JS and Vue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDK API</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Basics</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authentication-authorization.html">Authentication &amp; Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="database.html">Database</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="control.html">Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="storage.html">Storage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extra Features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Helping your module</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="settings.html">Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="testing.html">Testing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="events.html">Events</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="connections.html">Connections</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="stand-alone.html">Stand-alone features</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="filters.html">Filters</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="commands.html">Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="actions.html">Actions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="completion-conditions.html">Completion Conditions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SDK (Support)</span>
    <span class="version">master prerelease</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">AirTable</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../integration-airtable/develop/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">API Client</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-client-php/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">API Client Toolkit</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-client-php-toolkit/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Assign Roles</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-assign-roles/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Control</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../control-frontend/develop/developers/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Control (API)</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../control-api/develop/developers/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Control API Client</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-client-php-module-control/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Data Entry</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-data-entry/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Flyerless Club Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-flyerless-club-management/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../home/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Playground</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../playground/develop/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Portal</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../portal/develop/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">SDK (Support)</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../creating-module/index.html">master prerelease</a>
        </li>
        <li class="version is-latest">
          <a href="../v4.x/creating-module/index.html">v4.x</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Static Page</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-static-page/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Template</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-template/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Typeform</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-typeform/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Typeform Service</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../service-typeform/develop/users/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">UnionCloud</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../integration-unioncloud-control/develop/developers/index.html">develop</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Upload File</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../module-upload-file/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../home/1.0.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../creating-module/index.html">SDK (Support)</a></li>
    <li>SDK API</li>
    <li>Extra Features</li>
    <li>Helping your module</li>
    <li><a href="connections.html">Connections</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">master prerelease</button>
  <div class="version-menu">
    <a class="version is-current" href="connections.html">master prerelease</a>
    <a class="version" href="../v4.x/sdk-api/connections.html">v4.x</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/bristol-su/support/edit/master/antora-docs/modules/sdk-api/pages/connections.adoc">Edit this Page</a></div>
  
    <div class="view-on-github"><a href="https://github.com/bristol-su/support">View on GitHub</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Connections</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>One of the main uses of the portal is reducing the reliance on third
parties. If each possible third party has its own module, the module can be swapped with any other to provide the same functionality without changing the location or look of the portal.</p>
</div>
<div class="paragraph">
<p>For this to work, the third parties need their own module. It is highly
likely the module will need to use an API to connect to the third party. Each module instance may
need to connect to a different account each time it is used, since forms
may be stored in different places. In the case of a form platform, user 1 may set up an activity using a form they have created. User 2 also wants to use a form module, but their form resides on their form account. Therefore, we can&#8217;t have a single API connection defined in a <code>.env</code> file as normal, rather the credentials have to be manually specified.</p>
</div>
<div class="paragraph">
<p>Fortunately, the SDK makes this easy for you. it allows you to define how to connect to a third party, and makes sure users are connected before they start using your module. Therefore, as a developer, you never need to worry about authenticating with a third party.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_third_party_connection"><a class="anchor" href="#_creating_a_third_party_connection"></a>Creating a Third Party Connection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A third party connection is nothing more than a class which extends the <code>BristolSU\Support\Connection\Contracts\Connector</code> class. We call this class a connector, since it allows the SDK and a third party to communicate.</p>
</div>
<div class="paragraph">
<p>The connector should then implement all abstract functions. These include a <code>request</code> function for making a request, a <code>test</code> function for testing a connection, and a <code>settingsSchema</code> for defining the settings needed by the connector.</p>
</div>
<div class="sect2">
<h3 id="_defining_settings"><a class="anchor" href="#_defining_settings"></a>Defining Settings</h3>
<div class="paragraph">
<p>To define settings, you will need to use the normal Form Schema within the <code>settingsSchema</code> function. This may be as simple as needing a text field to take an API token. It may also be a lot more complex, for example in the case of OAuth logins.</p>
</div>
<div class="paragraph">
<p>For an OAuth login, we recommend creating a custom field which allows connections to be selected, and a login button. The login button will go through the normal oauth flow, and additional routes must be registered to collect the output of this and save the access token securely. Where there is a need to create endpoints to authorize against, you should define the endpoints in the config and have the default set as something like <code>/_connector/my-service</code>.</p>
</div>
<div class="paragraph">
<p>An example OAuth login can be found in our <a href="https://github.com/bristol-su/typeform-service">Typeform Service</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_making_a_request"><a class="anchor" href="#_making_a_request"></a>Making a Request</h3>
<div class="paragraph">
<p>Having defined the settings, your connector needs to be able to make requests. The request client (such as GuzzleHttp) can be accessed in your connectors <code>request</code> method through the <code>$client</code> property. To make a request with no authentication, you could use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">public function request($method, $uri, array $options = [])
{
    return $this-&gt;client-&gt;request($method, $uri, $options);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will usually want to add a token or similar to the request. To do this, you should edit the <code>$options</code> array before passing it to the client. To access the value of any settings you defined in the <code>settingsSchema</code> you can use the <code>getSetting()</code> method, which takes the setting key and an optional default. The options array will take the same options as GuzzleHttp does.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">public function request($method, $uri, array $options = [])
{
    $options['base_uri'] = config('typeform_service.base_uri');

    // Merge the headers from options if given.
    $headers = ((isset($options['headers']) &amp;&amp; is_array($options['headers']))?$options['headers']:[]);
    $headers['Authorization'] = 'Bearer ' . $this-&gt;getSetting('api_key');
    $options['headers'] = $headers;
    return $this-&gt;client-&gt;request($method, $uri, $options);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_connectors"><a class="anchor" href="#_testing_connectors"></a>Testing connectors</h3>
<div class="paragraph">
<p>To allow users to test their connection, you must also provide a <code>test</code> function. This is allowed to make use of the <code>getSetting</code> method, and should use your <code>request</code> method to make a call and check if it was successful or not. This will often be a <code>/user</code> or <code>/me</code> endpoint, but may be anything your API allows. This method should return true if the connection was made and the connector is ready to use, or false if the credentials were wrong.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_register_a_third_party_connection"><a class="anchor" href="#_register_a_third_party_connection"></a>Register a Third Party Connection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to use your third party connection, you must register it in your service provider. This can be done by calling the <code>registerConnector</code> class, or using the interface directly.</p>
</div>
<div class="paragraph">
<p>The <code>registerConnector</code> method takes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of the connector to show to users.</p>
</li>
<li>
<p>A description for the connector.</p>
</li>
<li>
<p>The alias of the connector. This should start with your service alias, and be unique to the connector.</p>
</li>
<li>
<p>The service the connector connects to (e.g. typeform, facebook)</p>
</li>
<li>
<p>The class name of the connector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The alias is the normal unique reference to the connector. Since APIs often have multiple ways to authenticate (e.g. through OAuth and an API key), you may want to accept either as a valid connector. Therefore, your module will just require a connection to, e.g., typeform and not care about the method of connecting, or the exact connector.</p>
</div>
<div class="paragraph">
<p>In a lot of cases, especially if the API only has one way to connect, you may not have a need for the service alias. It should still be given though, to ensure alternative authentication methods can be added in the future.</p>
</div>
<div class="paragraph">
<p>You may also use the interface directly. This takes the same arguments as the method.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">public function boot() {
    parent::boot();

    // Using the helper
    $this-&gt;registerConnector(
        'Typeform OAuth (recommended)',
        'Connect to Typeform using the OAuth flow',
        'typeform-oauth',
        'typeform',
        \My\Namespace\Typeform\OAuthConnector::class
    );

    // Manually
    $connectorStore = $this-&gt;app-&gt;make(\BristolSU\Support\Connection\Contracts\ConnectorStore::class);
    $connectorStore-&gt;register(
        'Typeform API Key',
        'Connect to Typeform using an API Key',
        'typeform-api-key',
        'typeform',
        \My\Namespace\Typeform\ApiKeyConnector::class
    );
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is common to find connectors in their own packages. In this case, as long as the package has pulled in the SDK, you can use the second method without registering a module to create a new connector. By using a separate package for a connector, you can use the same connector in multiple modules without them relying on one another.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_third_party_connection"><a class="anchor" href="#_using_a_third_party_connection"></a>Using a Third Party Connection</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_asking_for_a_connection"><a class="anchor" href="#_asking_for_a_connection"></a>Asking for a connection</h3>
<div class="paragraph">
<p>Having created and registered a way to use a third party connection, or pulled in a package which registers a third party connection, your module needs to let the portal know it wants to use the connector. There are two different types of request here, either a required or optional request. A required request will require the user to log into the third party in order to use your module. The optional request can be used to add additional functionality, such as posting to Facebook if you have logged in.</p>
</div>
<div class="paragraph">
<p>For either way, you should register the services you want in the <code>$requiredServices</code> and <code>$optionalServices</code> arrays in your service provider. Make sure you ask for the service, not for the connector alias. For example, ask for <code>'typeform'</code> not <code>'typeform-api-key'</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">protected $requiredServices = [
    'typeform', 'google-forms'
];

protected $optionalServices = [
    'facebook', 'twitter'
];</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also request these services manually in your service provider, by using the <code>ServiceRequest</code> class. You should only call each method once, or previous calls will be overridden.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public function boot()
{
    parent::boot();
    $serviceRequest = $this-&gt;app-&gt;make(\BristolSU\Support\Connection\ServiceRequest::class);
    $serviceRequest-&gt;required('my-module-alias', ['typeform', 'google-forms']);
    $serviceRequest-&gt;optional('my-module-alias', ['facebook', 'twitter']);
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_connection"><a class="anchor" href="#_using_the_connection"></a>Using the connection</h3>
<div class="paragraph">
<p>Having requested a service, the portal will ensure/ask for a connection to be made before your module is used. To retrieve the service with the connection made, you will need to use the following line</p>
</div>
<div class="paragraph">
<p><code>$connector = app(ModuleInstanceServiceRepository::class)-&gt;getConnectorForService('typeform', $moduleInstance-&gt;id)</code></p>
</div>
<div class="paragraph">
<p>This will retrieve the <code>typeform</code> service for the given module instance. If the connection has not been made for any reason, we will throw a <code>\BristolSU\Support\ModuleInstance\Connection\NoConnectionAvailable</code> exception. If you require the connection, you may let this exception bubble through to show the user an error and log the error. If you requested an optional module, you need to be aware that this may happen if the user has not created the connection. In this case, you should catch the exception to handle it gracefully.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">function hasFacebookConnection()
{
    try {
        $connector = app(ModuleInstanceServiceRepository::class)-&gt;getConnectorForService('typeform', $moduleInstance-&gt;id)
        return true;
    } catch (\BristolSU\Support\ModuleInstance\Connection\NoConnectionAvailable $e) {
        return false;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You may now call the <code>request</code> method on the connector to make an API call, passing a method, url and an array of Guzzle options.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">public function index(ModuleInstance $moduleInstance)
{
    $connector = app(ModuleInstanceServiceRepository::class)-&gt;getConnectorForService('typeform', $moduleInstance-&gt;id)
    $users = $connector-&gt;request('GET', '/users', []);
    ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using Antora.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
var search = docsearch({
  appId: 'X72DC2WY93',
  apiKey: '5a0df2d12ae0305890f5ff4ab7621747',
  indexName: 'portal-docs',
  inputSelector: '#search-input',
  autocompleteOptions: { autoselect: true, hint: false, keyboardShortcuts: ['/'] },
  algoliaOptions: { hitsPerPage: 10 }
}).autocomplete
search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
function focusSearchInput () { document.querySelector('#search-input').focus() }
if (document.querySelector('.home-link.is-current')) window.addEventListener('load', focusSearchInput)
</script>

<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
